{"$ref":"#/definitions/MiddlewareCompose","$schema":"http://json-schema.org/draft-07/schema#","definitions":{"CIDR":{"type":["string"]},"Duration":{"description":"Duration","type":"string"},"HTTPHeader":{"description":"HTTP Header","pattern":"^[a-zA-Z0-9\\-]+$","type":"string"},"LooseUse<\"cidr_whitelist\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"cidr_whitelist\">"},{"$ref":"#/definitions/SnakeToPascal<\"cidr_whitelist\">"},{"const":"cidr_whitelist","type":"string"}]},"LooseUse<\"cloudflare_real_ip\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"cloudflare_real_ip\">"},{"$ref":"#/definitions/SnakeToPascal<\"cloudflare_real_ip\">"},{"const":"cloudflare_real_ip","type":"string"}]},"LooseUse<\"hide_x_forwarded\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"hide_x_forwarded\">"},{"$ref":"#/definitions/SnakeToPascal<\"hide_x_forwarded\">"},{"const":"hide_x_forwarded","type":"string"}]},"LooseUse<\"oidc\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"oidc\">"},{"$ref":"#/definitions/SnakeToPascal<\"oidc\">"},{"const":"oidc","type":"string"}]},"LooseUse<\"rate_limit\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"rate_limit\">"},{"$ref":"#/definitions/SnakeToPascal<\"rate_limit\">"},{"const":"rate_limit","type":"string"}]},"LooseUse<\"real_ip\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"real_ip\">"},{"$ref":"#/definitions/SnakeToPascal<\"real_ip\">"},{"const":"real_ip","type":"string"}]},"LooseUse<\"redirect_http\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"redirect_http\">"},{"$ref":"#/definitions/SnakeToPascal<\"redirect_http\">"},{"const":"redirect_http","type":"string"}]},"LooseUse<\"set_x_forwarded\">":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<\"set_x_forwarded\">"},{"$ref":"#/definitions/SnakeToPascal<\"set_x_forwarded\">"},{"const":"set_x_forwarded","type":"string"}]},"LooseUse<(\"error_page\"|\"custom_error_page\")>":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<(\"error_page\"|\"custom_error_page\")>"},{"$ref":"#/definitions/SnakeToPascal<(\"error_page\"|\"custom_error_page\")>"},{"const":"error_page","type":"string"},{"const":"custom_error_page","type":"string"}]},"LooseUse<(\"modify_request\"|\"request\")>":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<(\"modify_request\"|\"request\")>"},{"$ref":"#/definitions/SnakeToPascal<(\"modify_request\"|\"request\")>"},{"const":"modify_request","type":"string"},{"const":"request","type":"string"}]},"LooseUse<(\"modify_response\"|\"response\")>":{"anyOf":[{"$ref":"#/definitions/SnakeToCamel<(\"modify_response\"|\"response\")>"},{"$ref":"#/definitions/SnakeToPascal<(\"modify_response\"|\"response\")>"},{"const":"modify_response","type":"string"},{"const":"response","type":"string"}]},"MiddlewareCompose":{"additionalProperties":{"items":{"$ref":"#/definitions/MiddlewareComposeItem"},"type":"array"},"type":"object"},"MiddlewareComposeItem":{"anyOf":[{"additionalProperties":false,"properties":{"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"use":{"$ref":"#/definitions/LooseUse<(\"error_page\"|\"custom_error_page\")>","title":"CustomErrorPage"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"use":{"$ref":"#/definitions/LooseUse<\"redirect_http\">","title":"RedirectHTTP"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"use":{"$ref":"#/definitions/LooseUse<\"set_x_forwarded\">","title":"SetXForwarded"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"use":{"$ref":"#/definitions/LooseUse<\"hide_x_forwarded\">","title":"HideXForwarded"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"allow":{"items":{"$ref":"#/definitions/CIDR"},"type":"array"},"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"message":{"default":"IP not allowed","description":"Error message when blocked","type":"string"},"status":{"$ref":"#/definitions/StatusCode","default":403,"description":"HTTP status code when blocked (alias of status_code)"},"status_code":{"$ref":"#/definitions/StatusCode","default":403,"description":"HTTP status code when blocked"},"use":{"$ref":"#/definitions/LooseUse<\"cidr_whitelist\">","title":"CIDRWhitelist"}},"required":["allow","use"],"type":"object"},{"additionalProperties":false,"properties":{"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"use":{"$ref":"#/definitions/LooseUse<\"cloudflare_real_ip\">","title":"CloudflareRealIP"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"add_headers":{"$ref":"#/definitions/Record<HTTPHeader,string>","description":"Add HTTP headers"},"add_prefix":{"description":"Add prefix to request URL","type":"string"},"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"hide_headers":{"description":"Hide HTTP headers","items":{"$ref":"#/definitions/HTTPHeader"},"type":"array"},"set_headers":{"$ref":"#/definitions/Record<HTTPHeader,string>","description":"Set HTTP headers"},"use":{"$ref":"#/definitions/LooseUse<(\"modify_request\"|\"request\")>","title":"ModifyRequest"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"add_headers":{"$ref":"#/definitions/Record<HTTPHeader,string>","description":"Add HTTP headers"},"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"hide_headers":{"description":"Hide HTTP headers","items":{"$ref":"#/definitions/HTTPHeader"},"type":"array"},"set_headers":{"$ref":"#/definitions/Record<HTTPHeader,string>","description":"Set HTTP headers"},"use":{"$ref":"#/definitions/LooseUse<(\"modify_response\"|\"response\")>","title":"ModifyResponse"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"allowed_groups":{"description":"Allowed groups","items":{"type":"string"},"minItems":1,"type":"array"},"allowed_users":{"description":"Allowed users","items":{"type":"string"},"minItems":1,"type":"array"},"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"use":{"$ref":"#/definitions/LooseUse<\"oidc\">","title":"OIDC"}},"required":["use"],"type":"object"},{"additionalProperties":false,"properties":{"average":{"description":"Average number of requests allowed in a period","type":"number"},"burst":{"description":"Maximum number of requests allowed in a period","type":"number"},"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"period":{"$ref":"#/definitions/Duration","default":"1s","description":"Duration of the rate limit"},"use":{"$ref":"#/definitions/LooseUse<\"rate_limit\">","title":"RateLimit"}},"required":["average","burst","use"],"type":"object"},{"additionalProperties":false,"properties":{"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"from":{"items":{"$ref":"#/definitions/CIDR"},"type":"array"},"header":{"$ref":"#/definitions/HTTPHeader","default":"X-Real-IP","description":"Header to get the client IP from"},"recursive":{"default":false,"description":"Recursive resolve the IP","type":"boolean"},"use":{"$ref":"#/definitions/LooseUse<\"real_ip\">","title":"RealIP"}},"required":["from","use"],"type":"object"},{"additionalProperties":false,"properties":{"bypass":{"items":{"$ref":"#/definitions/RuleOn"},"type":"array"},"use":{"$ref":"#/definitions/MiddlewareFileRef"}},"required":["use"],"type":"object"}]},"MiddlewareFileRef":{"type":"string"},"Record<HTTPHeader,string>":{"additionalProperties":{"type":"string"},"propertyNames":{"description":"HTTP Header","pattern":"^[a-zA-Z0-9\\-]+$"},"type":"object"},"RuleOn":{"anyOf":[{"$ref":"#/definitions/RuleOnHeader"},{"$ref":"#/definitions/RuleOnHeaderAnyValue"},{"$ref":"#/definitions/RuleOnQuery"},{"$ref":"#/definitions/RuleOnQueryAnyValue"},{"$ref":"#/definitions/RuleOnCookie"},{"$ref":"#/definitions/RuleOnCookieAnyValue"},{"$ref":"#/definitions/RuleOnForm"},{"$ref":"#/definitions/RuleOnFormAnyValue"},{"$ref":"#/definitions/RuleOnPostForm"},{"$ref":"#/definitions/RuleOnPostFormAnyValue"},{"$ref":"#/definitions/RuleOnMethod"},{"$ref":"#/definitions/RuleOnPath"},{"$ref":"#/definitions/RuleOnRemote"},{"$ref":"#/definitions/RuleOnRoute"},{"$ref":"#/definitions/RuleOnBasicAuth"}],"description":"Rule on","examples":["header Content-Type application/json","query key value","cookie key value","form key value","post_form key value","method GET","path /api/*","remote 127.0.0.1","route immich","basic_auth admin $2y$05$N3ZiFNDXVSMZ/OtcuSzGrOEBp15dqw6kQ9OJWvJSlgi9/zJ9LuCrm","rewrite / /index.html","serve /static","proxy http://localhost:8080","redirect https://example.com","redirect /index.html","error 404 \"Not Found\"","require_basic_auth \"Restricted Area\"","set headers Content-Type application/json","add headers Content-Type application/json","remove headers Content-Type","pass"]},"RuleOnBasicAuth":{"description":"basic_auth {username} {bcrypt_hashed_password}\n\nMatch the request basic authentication with the given username and bcrypt hashed password.","examples":["basic_auth admin $2y$05$N3ZiFNDXVSMZ/OtcuSzGrOEBp15dqw6kQ9OJWvJSlgi9/zJ9LuCrm"],"type":"string"},"RuleOnCookie":{"description":"cookie {key} {value}\n\nMatch the request cookie with the given key and value.","examples":["cookie key value"],"type":"string"},"RuleOnCookieAnyValue":{"description":"cookie {key}\n\nMatch the request cookie with the given key.","examples":["cookie key"],"type":"string"},"RuleOnForm":{"description":"form {key} {value}\n\nMatch the request form with the given key and value.","examples":["form key value"],"type":"string"},"RuleOnFormAnyValue":{"description":"form {key}\n\nMatch the request form with the given key.","examples":["form key"],"type":"string"},"RuleOnHeader":{"description":"header {key} {value}\n\nMatch the request header with the given key and value.","examples":["header Content-Type application/json"],"type":"string"},"RuleOnHeaderAnyValue":{"description":"header {key}\n\nMatch the request header with the given key.","examples":["header Content-Type"],"type":"string"},"RuleOnMethod":{"description":"method {http_method}\n\nMatch the request method with the given method.","enum":["method GET","method POST","method PUT","method PATCH","method DELETE","method CONNECT","method HEAD","method OPTIONS","method TRACE"],"examples":["method GET"],"type":"string"},"RuleOnPath":{"description":"path {glob_pattern}\n\nMatch the request path with the given glob pattern.","examples":["path /api/*"],"type":"string"},"RuleOnPostForm":{"description":"post_form {key} {value}\n\nMatch the request post form with the given key and value.","examples":["post_form key value"],"type":"string"},"RuleOnPostFormAnyValue":{"description":"post_form {key}\n\nMatch the request post form with the given key.","examples":["post_form key"],"type":"string"},"RuleOnQuery":{"description":"query {key} {value}\n\nMatch the request query with the given key and value.","examples":["query key value"],"type":"string"},"RuleOnQueryAnyValue":{"description":"query {key}\n\nMatch the request query with the given key.","examples":["query key"],"type":"string"},"RuleOnRemote":{"description":"remote {ip|cidr}\n\nMatch the request remote address with the given IP or CIDR.","examples":["remote 127.0.0.1"],"type":"string"},"RuleOnRoute":{"description":"route {alias}\n\nMatch the request route with the given alias.","examples":["route immich"],"type":"string"},"SnakeToCamel<\"cidr_whitelist\">":{"type":"string"},"SnakeToCamel<\"cloudflare_real_ip\">":{"type":"string"},"SnakeToCamel<\"hide_x_forwarded\">":{"type":"string"},"SnakeToCamel<\"oidc\">":{"type":"string"},"SnakeToCamel<\"rate_limit\">":{"type":"string"},"SnakeToCamel<\"real_ip\">":{"type":"string"},"SnakeToCamel<\"redirect_http\">":{"type":"string"},"SnakeToCamel<\"set_x_forwarded\">":{"type":"string"},"SnakeToCamel<(\"error_page\"|\"custom_error_page\")>":{"type":"string"},"SnakeToCamel<(\"modify_request\"|\"request\")>":{"type":"string"},"SnakeToCamel<(\"modify_response\"|\"response\")>":{"type":"string"},"SnakeToPascal<\"cidr_whitelist\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"cidr_whitelist\">>"},"SnakeToPascal<\"cloudflare_real_ip\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"cloudflare_real_ip\">>"},"SnakeToPascal<\"hide_x_forwarded\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"hide_x_forwarded\">>"},"SnakeToPascal<\"oidc\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"oidc\">>"},"SnakeToPascal<\"rate_limit\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"rate_limit\">>"},"SnakeToPascal<\"real_ip\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"real_ip\">>"},"SnakeToPascal<\"redirect_http\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"redirect_http\">>"},"SnakeToPascal<\"set_x_forwarded\">":{"$ref":"#/definitions/Title<SnakeToCamel<\"set_x_forwarded\">>"},"SnakeToPascal<(\"error_page\"|\"custom_error_page\")>":{"$ref":"#/definitions/Title<SnakeToCamel<(\"error_page\"|\"custom_error_page\")>>"},"SnakeToPascal<(\"modify_request\"|\"request\")>":{"$ref":"#/definitions/Title<SnakeToCamel<(\"modify_request\"|\"request\")>>"},"SnakeToPascal<(\"modify_response\"|\"response\")>":{"$ref":"#/definitions/Title<SnakeToCamel<(\"modify_response\"|\"response\")>>"},"StatusCode":{"description":"Status code","type":"number"},"Title<SnakeToCamel<\"cidr_whitelist\">>":{"type":"string"},"Title<SnakeToCamel<\"cloudflare_real_ip\">>":{"type":"string"},"Title<SnakeToCamel<\"hide_x_forwarded\">>":{"type":"string"},"Title<SnakeToCamel<\"oidc\">>":{"type":"string"},"Title<SnakeToCamel<\"rate_limit\">>":{"type":"string"},"Title<SnakeToCamel<\"real_ip\">>":{"type":"string"},"Title<SnakeToCamel<\"redirect_http\">>":{"type":"string"},"Title<SnakeToCamel<\"set_x_forwarded\">>":{"type":"string"},"Title<SnakeToCamel<(\"error_page\"|\"custom_error_page\")>>":{"type":"string"},"Title<SnakeToCamel<(\"modify_request\"|\"request\")>>":{"type":"string"},"Title<SnakeToCamel<(\"modify_response\"|\"response\")>>":{"type":"string"}}}